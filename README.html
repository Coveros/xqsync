<html xmlns="http://www.w3.org/1999/xhtml">
<!--
/*
 * Copyright (c)2005-2007 Mark Logic Corporation
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * The use of the Apache License does not indicate that this project is
 * affiliated with the Apache Software Foundation.
 */
-->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>XQSync README</title>
<style>
tr {
  vertical-align: top;
}
</style>
</head>
<body>
<h1>XQSync</h1>

<p>
To get started using XQSync, try the
<a href="http://developer.marklogic.com/howto/tutorials/2006-08-xqsync.xqy">tutorial</a>.
</p>

<h2>Running XQSync</h2>
<p>The entry point is the main method in the
 com.marklogic.ps.xqsync.XQSync class.
It takes zero or more property files as its arguments.
Any specified system properties will override file-based properties,
and properties found in later files may override properties
specified in earlier files on the command line.
See src/xqsync.sh for a sample shell script.
</p>

<h2>Required libraries:</h2>
<ul>
  <li>MarkLogic <a href="http://developer.marklogic.com/">XCC</a></li>
  <li>Codehaus <a href="http://xstream.codehaus.org/">XStream</a></li>
</ul>

<h2>Required properties:</h2>
<ul>
<li>one of: INPUT_PACKAGE, INPUT_CONNECTION_STRING</li>
<li>one of: OUTPUT_PACKAGE, OUTPUT_CONNECTION_STRING</li>
</ul>

<h2>Available properties:</h2>
<table border>
<tr><th>Property</th><th>default value</th><th>notes</th></tr>
<tr>
  <td>ALLOW_EMPTY_METADATA</td>
  <td>false</td>
  <td>
    If false, missing metadata files
    in <code>INPUT_PACKAGE</code> will be ignored.
  </td>
</tr>
<tr>
  <td>COPY_PERMISSIONS</td><td>true</td>
  <td>If true, all document permissions are copied.</td>
</tr>
<tr>
  <td>COPY_PROPERTIES</td><td>true</td>
  <td>If true, all document properties are copied.</td>
</tr>
<tr>
  <td>FATAL_ERRORS</td><td>true</td>
  <td>If true, all exceptions are fatal.</td>
</tr>
<tr>
  <td>INPUT_CONNECTION_STRING</td>
  <td>null</td>
  <td>
    Input documents will come from this XCC connection.
    By default, every document in the input database will be transferred.
    To change this behavior, use one of the related properties:
    <ul>
      <li<code>INPUT_COLLECTION_URI</code></li>
      <li><code>INPUT_DIRECTORY_URI</code></li>
      <li><code>INPUT_DOCUMENT_URIS</code></li>
      <li><code>INPUT_QUERY</code></li>
    </ul>
    NB - to list all input documents, or to list a collection or a directory,
    XQSync uses <code>cts:uris()</code>.
    If the document URI lexicon is not available,
    it will fall back to a slower technique.
  </td>
</tr>
<tr>
  <td>INPUT_COLLECTION_URI</td>
  <td>null</td>
  <td>In combination with INPUT_CONNECTION_STRING,
  all documents in the named collection(s) will be transferred.
    The value of this property will be tokenized on whitespace.
  </td>
</tr>
<tr>
  <td>INPUT_DIRECTORY_URI</td>
  <td>null</td>
  <td>In combination with INPUT_CONNECTION_STRING,
  all documents in the named directory will be transferred.</td>
</tr>
<tr>
  <td>INPUT_DOCUMENT_URIS</td>
  <td>null</td>
  <td>In combination with INPUT_CONNECTION_STRING,
  all documents named by the (whitespace-delimited) uris will be transferred.
  </td>
</tr>
<tr>
  <td>INPUT_QUERY</td>
  <td>null</td>
  <td>In combination with INPUT_CONNECTION_STRING,
    all uris returned by the query will be transferred.
    This sample query would transfer the first 100 documents,
    in document order:
    <br/>
    <code>for $i in doc()[1 to 100] return xdmp:node-uri($i)</code>
    <br/>
    If the document URI lexicon is enabled, this could be written as:
    <br/>
    <code>cts:uris('', 'document')[1 to 100]</code>
    <br/>
    to tranfer the first 100 documents, sorted by document URI.
  </td>
</tr>
<tr>
  <td>INPUT_PACKAGE</td>
  <td>null</td>
  <td>Input documents will come from this zip file path.</td>
</tr>
<!--
<tr>
  <td>INPUT_PATH</td>
  <td>null</td>
  <td>Input documents will come from this filesystem path.</td>
</tr>
-->
<tr>
  <td>INPUT_START_POSITION</td>
  <td>null</td>
  <td>Use the numeric value of this property as the starting position
  for the sequence of input documents.</td>
</tr>
<tr>
  <td>INPUT_TIMESTAMP</td>
  <td>null</td>
  <td>
    If not null, and <code>INPUT_CONNECTION_STRING</code> is set,
    then all input queries will use this timestamp.
    The special value <code>#AUTO</code>
    will cause the first request timestamp
    to be used for the entire synchronization.
  </td>
</tr>
<tr>
  <td>LOG_LEVEL</td><td>INFO</td>
  <td>java.util.logger.Level at which to log.</td>
</tr>
<tr>
  <td>LOG_HANDLER</td><td>CONSOLE,FILE</td>
  <td>java.util.logger log handlers with which to log.</td>
</tr>
<tr>
  <td>OUTPUT_COLLECTIONS</td>
  <td>null</td>
  <td>Output documents will be added to one or more collection URIs.
    Collection URIs may be delimited by whitespace, commas, or colons.
  </td>
</tr>
<tr>
  <td>OUTPUT_CONNECTION_STRING</td>
  <td>null</td>
  <td>Documents will be written to this XCC connection.</td>
</tr>
<tr>
  <td>OUTPUT_DELETE_COLLECTION</td>
  <td>null</td>
  <td>In combination with INPUT_COLLECTION_URI and OUTPUT_CONNECTION_STRING,
  delete the INPUT_COLLECTION_URI on the OUTPUT_CONNECTION_STRING,
  before beginning synchronization.</td>
</tr>
<tr>
  <td>OUTPUT_FORESTS</td><td>null</td><td>Permitted output forest names.</td>
</tr>
<!--
<tr>
  <td>OUTPUT_PATH</td>
  <td>null</td>
  <td>Output documents will be written to this filesystem path.</td>
</tr>
-->
<tr>
  <td>OUTPUT_PACKAGE</td>
  <td>null</td>
  <td>Output documents will be written to this zip file path.</td>
</tr>
<tr>
  <td>READ_PERMISSION_ROLES</td><td>null</td>
  <td>Names of any roles to attach to output documents.</td>
</tr>
<tr>
  <td>REPAIR_INPUT_XML</td><td>false</td>
  <td>Should MarkLogic Server try to repair malformed input XML?</td>
</tr>
<tr>
  <td>SKIP_EXISTING</td><td>false</td>
  <td>If true, documents that already exist in OUTPUT_CONNECTION
    are not overwritten. This only affects operations when
    OUTPUT_CONNECTION is defined. If false,
    or if targeting an OUTPUT_PACKAGE<!-- or an OUTPUT_PATH -->,
    then all documents will be overwritten.
  </td>
</tr>
<tr>
  <td>THREADS</td><td>1</td>
  <td>Number of worker threads to spawn.</td>
</tr>
<tr>
  <td>URI_PREFIX</td><td>null</td>
  <td>String to prepend to all output uris.</td>
</tr>
<tr>
  <td>URI_SUFFIX</td><td>null</td>
  <td>String to append to all output uris.</td>
</tr>
</table>
</body>
</html>